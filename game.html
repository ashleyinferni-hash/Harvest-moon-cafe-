<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whack-a-Bean Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Colors & Theme (Matching the Cafe Aesthetic) */
        :root {
            --color-primary: #8B4513; /* Earthy Brown */
            --color-secondary: #FFD700; /* Gold */
            --color-accent: #B8860B; /* Darker Gold/Bronze */
            --color-background: #F5F5DC; /* Cream/Beige */
        }
        body {
            background-color: var(--color-background);
            font-family: 'Georgia', serif;
            color: var(--color-primary);
        }

        /* The Game Grid (The "Holes") */
        .game-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            padding: 20px;
            border: 5px solid var(--color-accent);
            background-color: var(--color-primary);
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            max-width: 500px; /* Sizing for mobile play */
            margin: 20px auto;
        }

        /* The Individual "Hole" */
        .hole {
            width: 100%;
            padding-top: 100%; /* Creates a square container for the circle */
            position: relative;
            overflow: hidden;
            border-radius: 50%;
            background-color: #A0522D; /* Dirt/Ground color */
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        /* The "Bean" (The Mole) */
        .bean {
            position: absolute;
            top: 100%; /* Start hidden */
            left: 50%;
            transform: translate(-50%, 0);
            width: 80%;
            height: 80%;
            background-color: var(--color-secondary); /* Golden Bean */
            border-radius: 50%;
            cursor: pointer;
            transition: top 0.1s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
        }
        
        /* Animation when the bean is visible */
        .hole.up .bean {
            top: 10%; /* Slide up to be visible */
        }

        /* Visual effect when hit */
        .hit-effect {
            animation: hitFade 0.3s ease-out;
            opacity: 0;
            position: absolute;
            font-size: 2rem;
            font-weight: bold;
            color: limegreen;
            text-shadow: 1px 1px 2px black;
        }
        @keyframes hitFade {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.5); opacity: 0; }
        }
    </style>
</head>
<body class="p-4 text-center">

    <h1 class="text-4xl font-extrabold my-4 text-accent">Whack-a-Bean!</h1>
    <p class="mb-4 text-lg">Tap the golden coffee bean before it disappears!</p>
    
    <div class="flex justify-center items-center space-x-8 mb-6 text-xl font-semibold">
        <div id="scoreDisplay">Score: 0</div>
        <div id="timeDisplay">Time: 30s</div>
    </div>

    <button id="startButton" class="px-8 py-3 bg-secondary text-primary rounded-full hover:bg-white transition duration-300 shadow-lg text-xl font-bold mb-6">
        Start Game
    </button>
    
    <div class="game-grid" id="gameGrid">
        </div>

    <div id="gameOverMessage" class="hidden fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-20">
        <div class="bg-white p-8 rounded-lg shadow-2xl text-primary max-w-sm">
            <h3 class="text-3xl font-bold mb-4 text-accent">Game Over!</h3>
            <p class="text-xl mb-6">Final Score: <span id="finalScore" class="font-extrabold text-primary">0</span></p>
            <button id="playAgainButton" class="px-6 py-2 bg-secondary text-primary rounded-full hover:bg-accent hover:text-white transition duration-300 font-bold">
                Play Again
            </button>
        </div>
    </div>

    <script>
        const gameGrid = document.getElementById('gameGrid');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const timeDisplay = document.getElementById('timeDisplay');
        const startButton = document.getElementById('startButton');
        const gameOverMessage = document.getElementById('gameOverMessage');
        const finalScore = document.getElementById('finalScore');
        const playAgainButton = document.getElementById('playAgainButton');

        let score = 0;
        let time = 30;
        let lastHole;
        let timeUp = false;
        let timer;
        let gameLoop;
        const numHoles = 9;

        // --- Game Setup ---
        function createHoles() {
            for (let i = 0; i < numHoles; i++) {
                const hole = document.createElement('div');
                hole.classList.add('hole');
                hole.dataset.id = i;

                const bean = document.createElement('div');
                bean.classList.add('bean');
                bean.textContent = 'â˜•'; // Coffee emoji for the bean

                hole.appendChild(bean);
                hole.addEventListener('click', bonk);
                gameGrid.appendChild(hole);
            }
        }

        function getRandomHole() {
            const holes = document.querySelectorAll('.hole');
            const index = Math.floor(Math.random() * holes.length);
            const hole = holes[index];
            
            // Prevents the same bean from popping up twice in a row
            if (hole === lastHole) {
                return getRandomHole();
            }
            lastHole = hole;
            return hole;
        }

        function peep() {
            const timeMin = 500; // Minimum time bean is up (0.5 seconds)
            const timeMax = 1200; // Maximum time bean is up (1.2 seconds)
            const timeUp = Math.round(Math.random() * (timeMax - timeMin) + timeMin);
            const hole = getRandomHole();
            
            hole.classList.add('up');
            
            // Automatically hide the bean after the random time
            setTimeout(() => {
                hole.classList.remove('up');
                if (!timeUp) peep(); // Continue the game loop
            }, timeUp);
        }

        function bonk(e) {
            if (!e.isTrusted || !this.classList.contains('up')) return; // Ignore fake clicks or clicks when bean is down
            
            score++;
            this.classList.remove('up'); // Hide the bean immediately
            scoreDisplay.textContent = `Score: ${score}`;
            
            // Visual hit feedback
            const feedback = document.createElement('div');
            feedback.classList.add('hit-effect');
            feedback.textContent = '+1';
            feedback.style.top = '20%';
            feedback.style.left = '50%';
            feedback.style.transform = 'translate(-50%, -50%)';
            this.appendChild(feedback);
            
            setTimeout(() => feedback.remove(), 300);
        }

        function startGame() {
            score = 0;
            time = 30;
            timeUp = false;
            scoreDisplay.textContent = `Score: 0`;
            timeDisplay.textContent = `Time: 30s`;
            gameOverMessage.classList.add('hidden');
            startButton.classList.add('hidden');
            
            // Start the peep loop
            gameLoop = setInterval(peep, 800); // New bean pops up every 0.8 seconds

            // Start the timer
            timer = setInterval(() => {
                time--;
                timeDisplay.textContent = `Time: ${time}s`;
                if (time <= 0) {
                    clearInterval(timer);
                    clearInterval(gameLoop);
                    timeUp = true;
                    showGameOver();
                }
            }, 1000);

            // Initial call to start the first peep
            peep();
        }

        function showGameOver() {
            finalScore.textContent = score;
            gameOverMessage.classList.remove('hidden');
        }

        // --- Event Listeners and Initialization ---
        startButton.addEventListener('click', startGame);
        playAgainButton.addEventListener('click', startGame);
        
        createHoles(); // Build the game board when the page loads
    </script>
</body>
</html>
